<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Détails  d'une catégorie</title>
        <!-- Charger la bibliothèque d’icônes Font Awesome depuis un CDN (Cloudflare), 
             Avec vérification de sécurité (SRI) (integrity)
             Sans fuite de données (referrer + crossorigin)  -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="   
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="page-header">
        <h2>Détails d'une catégorie</h2>

        <div class="header-actions">
            <button class="back-btn" onclick="window.location.href='getCategoryList.html'">
                <i class="fa-solid fa-arrow-left"></i>
                Retour à la liste
            </button>
            <button class="edit-btn" id="editBtn">
                <i class="fa-regular fa-pen-to-square"></i>
                Modifier
            </button>
        </div>
    </div>

    <div class="card">
        <div class="field-label">Nom</div>
        <div class="field-value" id="nameValue">Chargement...</div>

    </div>

    <div id="message"></div>

    <script>
        const API_BASE_URL = 'http://localhost:3000/api/categories';

        const nameValue  = document.getElementById('nameValue');
        const messageDiv = document.getElementById('message');
        const editBtn    = document.getElementById('editBtn');

        const params = new URLSearchParams(window.location.search);
        const categoryId = params.get('id');

        if (!categoryId) {
            messageDiv.style.color = 'red';
            messageDiv.textContent = 'Aucune ID fournie dans l’URL.';
            nameValue.textContent  = '-';
            editBtn.disabled = true;
        } else {
            editBtn.addEventListener('click', () => {
                window.location.href = `editCategory.html?id=${categoryId}`;
            });

            loadCategory();
        }

        /**
         * Charge les données depuis le serveur et l'affiche dans la page.
         * En cas d'erreur, un message d'erreur est affiché et les valeurs sont
         * initialisées à "-".
         */
        async function loadCategory() {
            try {
                const response = await fetch(`${API_BASE_URL}/${categoryId}`);
                const category = await response.json();

                if (!response.ok || !category) {
                    messageDiv.style.color = 'red';
                    messageDiv.textContent = 'Impossible de charger cette catégorie.';
                    nameValue.textContent  = '-';
                    return;
                }

                nameValue.textContent  = category.nom  ?? '-';

            } catch (error) {
                console.error('Erreur chargement catégorie :', error);
                messageDiv.style.color = 'red';
                messageDiv.textContent = 'Erreur lors du chargement de la catégorie.';
                nameValue.textContent  = '-';
            }
        }
    </script>

</body>
</html>
